---
  - name: "Setup CRC Storage, install the operator and Post tests"
    hosts: all
    tasks:     
      - name: CRC storage setup
        shell: |
          bash $HOME/setup_crc_storage.sh &>> $HOME/setup_crc_storage.log
        register: task_register_var
        until: task_register_var is not failed
        retries: 5

      - name: Install the operators
        shell: |
          bash $HOME/install_operator_with_hash.sh keystone-operator quay.io/sandyada 491c5a3c564ce75f4962b1aae89cc11a530f7156 &>> $HOME/install_operator.log
        register: task_register_var
        until: task_register_var is not failed
        retries: 5

      - name: Post tests
        shell: |
          set -ex
          export OS_PROJECT_NAME=admin
          export OS_USERNAME=admin
          export OS_PASSWORD=12345678
          export OS_AUTH_URL=http://keystone-public-openstack.apps-crc.testing
          export OS_USER_DOMAIN_NAME=Default
          export OS_PROJECT_DOMAIN_NAME=Default
          openstack token issue
        register: task_register_var
        until: task_register_var is not failed
        retries: 10
        
      - debug: 
          msg: "{{ task_register_var }}"        
