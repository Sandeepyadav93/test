---
  - name: "Start CRC Node and install the operator"
    hosts: all
    tasks:
      - name: Start CRC node
        shell: "crc start"

      - name: Install operator
        shell: |
          eval $(crc oc-env)
          oc login -u kubeadmin https://api.crc.testing:6443
          cd $HOME/install_yamls
          make crc_storage
          make mariadb
          sleep 30 # wait 30 seconds so that operator install completes successfully, will replace with better check
          # KEYSTONE_IMG=quay.io/mschuppe/keystone-operator-index:v0.0.34 KEYSTONE_REPO=https://github.com/stuggi/keystone-operator.git KEYSTONE_BRANCH=rework make keystone
          KEYSTONE_IMG=quay.io/sandyada/keystone-operator-index:v0.0.12 make keystone
          sleep 30 # wait 30 seconds so that operator install completes successfully, will replace with better check
          make mariadb_deploy
          sleep 60 # wait 60 seconds so that mariadb service install successfully, will replace with better checks
          make keystone_deploy
          sleep 90 # wait 120 seconds so that keystone service install successfully, will replace with better checks

      - name: Install operator
        shell: |
          export OS_PROJECT_NAME=admin
          export OS_USERNAME=admin
          export OS_PASSWORD=12345678
          export OS_AUTH_URL=http://keystone-public-openstack.apps-crc.testing
          export OS_USER_DOMAIN_NAME=Default
          export OS_PROJECT_DOMAIN_NAME=Default
          openstack token issue
